<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión de Incidencias</title>

<style>
* { box-sizing:border-box; font-family:Segoe UI, Arial, sans-serif; }
body { margin:0; padding:24px; background:#f4f6fb; }

/* HEADER */
.header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 24px;
}

.header a {
  text-decoration: none;
  font-size: 22px;
  color: #374151;
}

.header h1 {
  font-size: 22px;
  margin: 0;
}

.subtitle {
  color: #000000;
  font-size: 14px;
}

/* SUMMARY */
.summary { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:20px; }
.summary-card { background:#fff; padding:16px; border-radius:12px; display:flex; gap:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); }
.icon { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; }
.pending{background:#fff3cd;color:#996100}
.resolved{background:#d1fae5;color:#006b47}
.blocked{background:#fee2e2;color:#d10000}

/* FILTERS */
.filters{background:#fff;padding:16px;border-radius:12px;display:flex;justify-content:space-between;margin-bottom:20px}
select{padding:8px 12px;border-radius:8px;border:1px solid #d1d5db}

/* INCIDENT */
.incident{background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;display:flex;justify-content:space-between;box-shadow:0 2px 6px rgba(0,0,0,.06)}
.incident-left{display:flex;gap:14px}
.incident-icon{width:42px;height:42px;border-radius:50%;background:#eef2ff;display:flex;align-items:center;justify-content:center}
.badge{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600}
.details-btn{border:1px solid #d1d5db;background:#fff;border-radius:8px;padding:8px 12px;cursor:pointer}

/* MODAL */
.modal-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.4);
  display:none; align-items:center; justify-content:center;
}
.modal{
  background:#fff; width:420px; border-radius:14px; padding:20px;
}
.modal h3{margin-top:0}
.modal p{font-size:14px;color:#4b5563}
.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}
.btn{padding:8px 14px;border-radius:8px;border:1px solid #d1d5db;cursor:pointer}
.btn.primary{background:#2563eb;color:#fff;border:none}
</style>
</head>

<body>

<div class="header">
  <a href="../pages/admin.html">←</a>
  <div>
    <h1>Gestión de Incidencias</h1>
    <div class="subtitle">Revisar y gestionar incidencias reportadas</div>
  </div>
</div>


<div class="summary">
  <div class="summary-card"><div class="icon pending">⏱</div><div>Pendientes<br><strong id="cp">0</strong></div></div>
  <div class="summary-card"><div class="icon resolved">✔</div><div>Resueltas<br><strong id="cr">0</strong></div></div>
  <div class="summary-card"><div class="icon blocked">✖</div><div>Bloqueadas<br><strong id="cb">0</strong></div></div>
</div>

<div class="filters">
  <select id="stateFilter">
    <option value="all">Todos los estados</option>
    <option value="pending">Pendiente</option>
    <option value="resolved">Resuelta</option>
    <option value="blocked">Bloqueada</option>
  </select>

  <select id="dateFilter">
    <option value="today">Hoy</option>
    <option value="week">Esta semana</option>
    <option value="month">Este mes</option>
    <option value="all">Histórico</option>
  </select>
</div>

<div id="incidents"></div>

<!-- MODAL -->
<div class="modal-backdrop" id="modal">
  <div class="modal">
    <h3>Detalles de la Incidencia</h3>
    <p><strong id="mEmail"></strong></p>
    <p id="mType"></p>
    <p id="mDate"></p>
    <p id="mComment"></p>

    <label>Estado</label>
    <select id="mState">
      <option value="pending">Pendiente</option>
      <option value="resolved">Resuelta</option>
      <option value="blocked">Bloqueada</option>
    </select>

    <div class="modal-footer">
      <button class="btn" onclick="closeModal()">Cancelar</button>
      <button class="btn primary" onclick="saveModal()">Guardar cambios</button>
    </div>
  </div>
</div>

<script>
const data = [
  {email:"juan.garcia@empresa.com",type:"Olvido de fichaje",date:"2024-11-18T09:30",state:"pending",comment:"Olvidé fichar la entrada esta mañana."},
  {email:"maria.lopez@empresa.com",type:"Error de fichaje",date:new Date().toISOString(),state:"resolved",comment:"Salida marcada como pausa."},
  {email:"carlos.martinez@empresa.com",type:"Olvido de fichaje",date:daysAgo(2),state:"pending",comment:"App no disponible."},
  {email:"ana.rodriguez@empresa.com",type:"Error de fichaje",date:daysAgo(5),state:"blocked",comment:"Registro duplicado."},
  {email:"luis.perez@empresa.com",type:"Olvido de fichaje",date:daysAgo(12),state:"pending",comment:"No fichó entrada."},
  {email:"sofia.diaz@empresa.com",type:"Error de fichaje",date:daysAgo(20),state:"resolved",comment:"Hora incorrecta."},
  {email:"pedro.sanchez@empresa.com",type:"Olvido de fichaje",date:daysAgo(40),state:"blocked",comment:"Fuera de plazo."}
];

function daysAgo(d){ const dt=new Date(); dt.setDate(dt.getDate()-d); return dt.toISOString(); }

const container=document.getElementById("incidents");
let current=null;

function render(){
  container.innerHTML="";
  let cp=0,cr=0,cb=0;

  data.forEach((i,idx)=>{
    if(i.state==="pending")cp++;
    if(i.state==="resolved")cr++;
    if(i.state==="blocked")cb++;

    const el=document.createElement("div");
    el.className="incident";
    el.dataset.idx=idx;
    el.dataset.state=i.state;
    el.dataset.date=i.date;

    el.innerHTML=`
      <div class="incident-left">
        <div class="incident-icon">!</div>
        <div>
          <strong>${i.type}</strong>
          <span class="badge ${i.state}">${label(i.state)}</span>
          <p>${i.email}</p>
          <p>${new Date(i.date).toLocaleString()}</p>
        </div>
      </div>
      <button class="details-btn" onclick="openModal(${idx})">Ver detalles</button>
    `;
    container.appendChild(el);
  });

  cpEl.textContent=cp; crEl.textContent=cr; cbEl.textContent=cb;
  applyFilters();
}

function label(s){return s==="pending"?"Pendiente":s==="resolved"?"Resuelta":"Bloqueada";}

function openModal(idx){
  current=idx;
  const i=data[idx];
  mEmail.textContent=i.email;
  mType.textContent=i.type;
  mDate.textContent=new Date(i.date).toLocaleString();
  mComment.textContent=i.comment;
  mState.value=i.state;
  modal.style.display="flex";
}

function closeModal(){ modal.style.display="none"; }

function saveModal(){
  data[current].state=mState.value;
  closeModal();
  render();
}

function applyFilters(){
  const s=stateFilter.value;
  const d=dateFilter.value;
  document.querySelectorAll(".incident").forEach(el=>{
    const diff=(new Date()-new Date(el.dataset.date))/86400000;
    const okState=s==="all"||el.dataset.state===s;
    const okDate=d==="all"||(d==="today"&&diff<1)||(d==="week"&&diff<=7)||(d==="month"&&diff<=30);
    el.style.display=(okState&&okDate)?"":"none";
  });
}

stateFilter.onchange=applyFilters;
dateFilter.onchange=applyFilters;

const cpEl=document.getElementById("cp");
const crEl=document.getElementById("cr");
const cbEl=document.getElementById("cb");

render();
</script>

</body>
</html>
