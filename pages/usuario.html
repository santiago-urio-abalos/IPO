<!DOCTYPE html>
<html lang="es">

<head>
    <script>
        (function () {
            try {
                if (localStorage.getItem("darkMode") === "enabled") {
                    document.documentElement.classList.add("dark");
                }
            } catch (e) {}
        })();
    </script>

    <link rel="stylesheet" href="../css/dark-mode.css">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        crossorigin="anonymous" />

    <meta charset="UTF-8" />
    <title>Usuario</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .slider-track {
            position: relative;
            height: 54px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            overflow: hidden;
            cursor: grab;
            transition: opacity 0.3s ease, background-color 0.3s ease;
        }

        .slider-thumb {
            position: absolute;
            height: 44px;
            width: 44px;
            border-radius: 9999px;
            background: #1f0f0f;
            top: 5px;
            left: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            transition: left 0.1s linear;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25);
        }

        .slider-track.disabled {
            opacity: 0.45;
            cursor: not-allowed !important;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
        }

        .icon-img {
            width: 34px;
            height: 34px;
            border-radius: 50%;
        }
        button {
            background-color: var(--btn-bg);
            color: var(--btn-text);
        }

        /* ===== DARK MODE SUPPORT (SOLO VISUAL) ===== */

/* Fondo general */
html.dark body {
    background-color: #111827;
}

/* Contenedor principal */
html.dark .max-w-xl {
    background-color: #111827;
}

/* Cards / cajas blancas */
html.dark .bg-white {
    background-color: #1f2937 !important;
}

/* Textos */
html.dark .text-gray-500 {
    color: #9ca3af !important;
}

/* Modal */
html.dark #confirmModal > div {
    background-color: #1f2937;
    color: #ffffff;
}

/* Iconos PNG negros → blancos */
html.dark img.icon-img {
    filter: invert(1) brightness(1.2);
}
html.dark {
    color-scheme: dark;
    --btn-bg: #374151;   /* gris oscuro */
    --btn-text: #f9fafb; /* blanco */
}

    </style>
</head>

<body class="bg-[#F4F7FB] min-h-screen">

<!-- CONTENEDOR PRINCIPAL -->
<div class="max-w-xl mx-auto min-h-screen bg-[#F4F7FB]">


    <!-- Header -->
    <div class="p-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold">Hola, Usuario</h1>

        <button class="icon-btn" aria-label="perfil de usuario" onclick="window.location.href='../features/settings.html'">
            <i class="fa-solid fa-user text-2xl"></i>
        </button>
    </div>

    <!-- Hora -->
    <div class="px-6">
        <div class="p-10 bg-blue-600 rounded-2xl text-white text-center shadow">
            <h2 class="font-bold text-lg">Hora actual</h2>
            <p id="time" class="text-4xl font-bold mt-2"></p>
            <p id="date" class="mt-2"></p>
        </div>
    </div>

    <!-- SLIDER JORNADA -->
    <div class="px-6 mt-6">
        <div id="sliderJornada" class="slider-track text-white shadow"
            style="background-color:#15803D;">
            <div id="thumbJornada" class="slider-thumb">➜</div>
            <span id="labelJornada" class="mx-auto font-medium">
                Desliza para iniciar jornada
            </span>
        </div>
    </div>

    <!-- SLIDER PAUSA -->
    <div class="px-6 mt-4">
        <div id="sliderPausa" class="slider-track text-white shadow disabled"
            style="background-color:#ce3d1c;">
            <div id="thumbPausa" class="slider-thumb">➜</div>
            <span id="labelPausa" class="mx-auto font-medium">
                Desliza para iniciar pausa
            </span>
        </div>
    </div>

    <!-- Modal -->
    <div id="confirmModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center">
        <div class="bg-white w-80 p-6 rounded-xl shadow text-center">
            <p id="modalMessage" class="text-lg font-semibold mb-4">¿Confirmar acción?</p>
            <div class="flex gap-4 justify-center">
                <button id="btnNo" class="px-4 py-2 bg-red-700 text-white rounded-lg">No</button>
                <button id="btnSi" class="px-4 py-2 bg-green-700 text-white rounded-lg">Sí</button>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div class="px-6 mt-6 grid grid-cols-1 gap-4 pb-8">

        <div class="bg-white p-6 rounded-2xl shadow flex items-center gap-4 cursor-pointer hover:shadow-lg transition"
            onclick="window.location.href='../features/resumen.html'">
            <i class="fa-solid fa-clock text-blue-600 text-3xl"></i>
            <div>
                <h3 class="font-bold text-lg">Resumen del día</h3>
                <p class="text-gray-500 text-sm">Ver jornada completa</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow flex items-center gap-4 cursor-pointer hover:shadow-lg transition"
            onclick="window.location.href='../features/semana.html'">
            <i class="fa-solid fa-calendar-week text-green-600 text-3xl"></i>
            <div>
                <h3 class="font-bold text-lg">Semana</h3>
                <p class="text-gray-500 text-sm">Gráfico semanal</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow flex items-center gap-4 cursor-pointer hover:shadow-lg transition"
            onclick="window.location.href='../features/calendario.html'">
            <i class="fa-solid fa-calendar-days text-purple-600 text-3xl"></i>
            <div>
                <h3 class="font-bold text-lg">Calendario</h3>
                <p class="text-gray-500 text-sm">Vista mensual</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow flex items-center gap-4 cursor-pointer hover:shadow-lg transition"
            onclick="window.location.href='../features/incidencias.html'">
            <i class="fa-solid fa-triangle-exclamation text-red-600 text-3xl"></i>
            <div>
                <h3 class="font-bold text-lg">Incidencias</h3>
                <p class="text-gray-500 text-sm">Crear o revisar</p>
            </div>
        </div>

    </div>
    <!-- TOAST NOTIFICACIÓN -->
    <div id="toast"
        style="display:none"
        class="fixed bottom-6 right-6 bg-green-700 text-white px-5 py-3 rounded-xl shadow-xl flex items-center gap-3 z-[9999]">
        <i class="fa-solid fa-check-circle text-xl"></i>
        <span id="toastMessage">Acción registrada correctamente</span>
    </div>


</div>

<!-- JS ORIGINAL (sin cambios) -->
<script>
    function updateClock() {
        const now = new Date();
        document.getElementById("time").textContent =
            now.toLocaleTimeString("es-ES", { hour: "2-digit", minute: "2-digit" });
        document.getElementById("date").textContent =
            now.toLocaleDateString("es-ES", { weekday: 'long', day: 'numeric', month: 'long' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    let jornadaIniciada = false;
    let pausaIniciada = false;
    let activeSlider = null;

    const sliders = {
        jornada: {
            track: document.getElementById("sliderJornada"),
            thumb: document.getElementById("thumbJornada"),
            label: document.getElementById("labelJornada"),
        },
        pausa: {
            track: document.getElementById("sliderPausa"),
            thumb: document.getElementById("thumbPausa"),
            label: document.getElementById("labelPausa"),
        }
    };

    function setupSlider(key) {
        const s = sliders[key];
        let dragging = false;
        let startX = 0;

        s.track.addEventListener("mousedown", (e) => {
            if (s.track.classList.contains("disabled")) return;
            dragging = true;
            startX = e.clientX;
        });

        document.addEventListener("mousemove", (e) => {
            if (!dragging) return;
            let delta = e.clientX - startX;
            let max = s.track.offsetWidth - 54;
            delta = Math.max(0, Math.min(delta, max));
            s.thumb.style.left = delta + "px";
        });

        document.addEventListener("mouseup", () => {
            if (!dragging) return;
            dragging = false;
            let max = s.track.offsetWidth - 54;
            if (parseInt(s.thumb.style.left) >= max - 5) {
                activeSlider = key;
                openConfirm(key);
            }
            s.thumb.style.left = "5px";
        });
    }

    setupSlider("jornada");
    setupSlider("pausa");

    const modal = document.getElementById("confirmModal");
    const modalMessage = document.getElementById("modalMessage");

    function openConfirm(key) {
        modalMessage.textContent =
            key === "jornada"
                ? (jornadaIniciada ? "¿Desea terminar la jornada?" : "¿Desea iniciar la jornada?")
                : (pausaIniciada ? "¿Desea terminar la pausa?" : "¿Desea iniciar la pausa?");
        modal.classList.remove("hidden");
    }

    document.getElementById("btnNo").onclick = () => {
        modal.classList.add("hidden");
        activeSlider = null;
    };

    document.getElementById("btnSi").onclick = () => {
        if (activeSlider === "jornada") {
            jornadaIniciada = !jornadaIniciada;
            sliders.jornada.label.textContent =
                jornadaIniciada ? "Desliza para finalizar jornada" : "Desliza para iniciar jornada";
            sliders.jornada.track.style.backgroundColor =
                jornadaIniciada ? "#116931" : "#15803D";
            sliders.pausa.track.classList.toggle("disabled", !jornadaIniciada);
        }

        if (activeSlider === "pausa") {
            pausaIniciada = !pausaIniciada;
            sliders.pausa.label.textContent =
                pausaIniciada ? "Desliza para terminar pausa" : "Desliza para iniciar pausa";
            sliders.pausa.track.style.backgroundColor =
                pausaIniciada ? "#a13017" : "#ce3d1c";
            sliders.jornada.track.classList.toggle("disabled", pausaIniciada);
        }
        const accion = activeSlider; // ← GUARDAMOS LA ACCIÓN

        modal.classList.add("hidden");
        activeSlider = null;

        if (accion === "jornada") {
            showToast(
                jornadaIniciada
                    ? "Jornada iniciada correctamente"
                    : "Jornada finalizada correctamente"
            );
        }

        if (accion === "pausa") {
            showToast(
                pausaIniciada
                    ? "Pausa iniciada correctamente"
                    : "Pausa finalizada correctamente"
            );
        }


    };

</script>
<script>
    const toast = document.getElementById("toast");
    const toastMessage = document.getElementById("toastMessage");
    let toastTimeout;

    function showToast(message) {
        console.log("Toast mostrado:", message); // DEBUG
        toastMessage.textContent = message;
        toast.style.display = "flex";

        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
            toast.style.display = "none";
        }, 3000);
    }
</script>
<script src="../js/dark-mode.js" type="module"></script>

</body>
</html>
