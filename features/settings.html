<!DOCTYPE html>
<html lang="es">
<head>

    <!-- ===== APLICAR TEMA ANTES DE RENDER (ANTI-FLASH) ===== -->
    <script>
        (function () {
            try {
                if (localStorage.getItem("darkMode") === "enabled") {
                    document.documentElement.classList.add("dark");
                }
            } catch (e) {}
        })();
    </script>

    <!-- ===== FONDO BASE (CLARO / OSCURO) ===== -->
    <style>
        html {
            background-color: #F4F7FB;
        }
        html.dark {
            background-color: #111827;
        }
    </style>

    <meta charset="UTF-8">
    <title>Perfil y configuración</title>

    <!-- ===== CSS DARK MODE GLOBAL ===== -->
    <link rel="stylesheet" href="../css/dark-mode.css">

    <!-- ===== TAILWIND ===== -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ===== FONT AWESOME ===== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* ===== CONTENEDOR ===== */
        .main-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
        }

        html:not(.dark) .main-container {
            background-color: #F4F7FB;
            color: #1f2937;
        }

        html.dark .main-container {
            background-color: #111827;
            color: #ffffff;
        }

        /* ===== TOPBAR ===== */
        .topbar {
            background: #ffffff;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        html.dark .topbar {
            background: #0f172a;
            color: #ffffff;
        }

        .topbar svg {
            width: 24px;
            height: 24px;
            cursor: pointer;
            fill: currentColor;
        }

        /* ===== USUARIO ===== */
        .user-card { display: flex; align-items: center; gap: 14px; }
        .user-avatar {
            width: 55px;
            height: 55px;
            background: #2563eb;
            color: #fff;
            border-radius: 50%;
            display: flex;
            font-size: 24px;
            align-items: center;
            justify-content: center;
        }

        /* ===== SECCIONES ===== */
        .settings-section {
            margin-top: 32px;
            padding-bottom: 14px;
            border-bottom: 1px solid #e5e7eb;
        }

        html.dark .settings-section {
            border-color: #374151;
        }

        /* ===== SWITCH ===== */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 18px;
        }

        .switch-full {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            cursor: pointer;
        }

        .switch-wrapper {
            position: relative;
            width: 46px;
            height: 24px;
        }

        .switch-wrapper input {
            position: absolute;
            width: 46px;
            height: 24px;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
            margin: 0;
        }

        .switch-wrapper .slider {
            position: absolute;
            top: 0;
            left: 0;
            width: 46px;
            height: 24px;
            background: #ccc;
            border-radius: 24px;
            transition: .3s;
        }

        .switch-wrapper .slider::before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            left: 2px;
            top: 2px;
            background: #ffffff;
            border-radius: 50%;
            transition: .3s;
        }

        .switch-wrapper input:checked + .slider {
            background: #2563eb;
        }

        .switch-wrapper input:checked + .slider::before {
            transform: translateX(22px);
        }

        /* ===== SELECT ===== */
        html.dark select {
            background-color: #1f2937;
            color: #ffffff;
            border-color: #374151;
        }

        /* ===== LOGOUT ===== */
        .logout-btn {
            width: 100%;
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px;
            margin-top: 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        html.dark .logout-btn {
            background-color: #b91c1c;
        }
    </style>
</head>

<body>

<div class="main-container">

    <div class="topbar">
        <svg id="btnBack" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15 18l-6-6 6-6"/>
        </svg>
        <h1>Perfil y configuración</h1>
    </div>

    <div class="p-6">

        <div class="settings-section user-card">
            <div class="user-avatar">U</div>
            <div>
                <h3 class="user-name"></h3>
                <p class="user-email"></p>
            </div>
        </div>

        <!-- Preferencias -->
        <div class="settings-section">
            <h3 class="font-semibold">Preferencias</h3>
            <p class="section-desc">Personaliza tu experiencia</p>

            <div class="setting-item">
                <label class="switch-full">
                    <span class="switch-text">Tema oscuro</span>
                    <div class="switch-wrapper">
                        <input type="checkbox" id="darkModeToggle">
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
        </div>

       

        <button class="logout-btn" id="logoutBtn">Cerrar sesión</button>
    </div>
</div>

<!-- ===== DARK MODE (TOGGLE + GLOBAL) ===== -->
<script src="../js/dark-mode.js" type="module"></script>

<!-- ===== FIREBASE + NAVEGACIÓN (ORIGINAL, SIN TOCAR) ===== -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAvCdYCrUbv37mulXHDtYvRhTTNXDyNiFc",
        authDomain: "click-df584.firebaseapp.com",
        projectId: "click-df584",
        storageBucket: "click-df584.firebasestorage.app",
        messagingSenderId: "410988732262",
        appId: "1:410988732262:web:0531fd4ed3bdc01fa2f2a7"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const nameEl  = document.querySelector(".user-name");
    const emailEl = document.querySelector(".user-email");
    const logoutBtn = document.getElementById("logoutBtn");

    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "/../index.html";
            return;
        }
        nameEl.textContent  = user.displayName || "Usuario";
        emailEl.textContent = user.email || "";
    });

    logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
        window.location.href = "../index.html";
    });

    document.getElementById("btnBack").addEventListener("click", () => {
        const role = localStorage.getItem("userRole") || "user";
        window.location.href =
            role === "admin" ? "../pages/admin.html" :
            role === "rrhh"  ? "../pages/rrhh.html" :
                               "../pages/usuario.html";
    });
</script>

</body>
</html>
